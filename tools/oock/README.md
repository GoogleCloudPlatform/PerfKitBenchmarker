# One Off Chart Kit (OOCK)

This is a simple webserver that parses a page specification yaml, generates HTML and javascript (which utilizes the google charts js API), and serves simple rendered charts to port 8080 via HTTP.

## Example

Here's an example chart page that renders a single graph - object size vs p50 upload latency. Data was generated by the object_storage_service benchmark using the api_multistream scenario:

```yaml
latency_vs_size_sizes: &latency_vs_size_sizes
>
  [1, 64, 512, 1000, 4000, 16000, 32000, 64000, 128000, 256000, 512000, 1000000,
   2000000, 6000000, 4000000, 8000000, 12000000, 16000000, 24000000, 32000000,
   40000000, 48000000, 56000000, 64000000, 72000000, 80000000, 88000000,
   96000000, 104000000, 112000000, 120000000, 128000000, 144000000, 160000000,
   176000000, 192000000, 208000000, 224000000, 240000000, 256000000]

chart_specs:
  p50_upload_latency_vs_size:
    columns: [[number, size], [number, GCS], [number, S3], [number, ABS]]
    data_source:
      path: latency_vs_size_in_region.json
      label_column:
        source: metadata
        field: object_size_B
        parse: int(object_size_B)
        order: increasing
      series_columns:
      - select: { metadata: [cloud] }
        condition: cloud == 'GCP'
        parse: float(value) * 1000.0
      - select: { metadata: [cloud] }
        condition: cloud == 'AWS'
        parse: float(value) * 1000.0
      - select: { metadata: [cloud], sample: [value] }
        condition: cloud == 'Azure' and value < 5
        parse: float(value) * 1000.0
      filters:
      - select: { sample: [metric] }
        condition: metric == 'Multi-stream upload latency p50'
      - select: { metadata: [object_size_B] }
        condition: ["object_size_B != 'distribution' and ",
                    "int(object_size_B) in ", *latency_vs_size_sizes]
      - select: { metadata: [zone] }
        condition:
          zone == 'us-west1-a' or zone == 'us-west-1a' or zone == 'westus'
      - select: { metadata: [regional_bucket_location] }
        condition:
        - "regional_bucket_location == 'us-west1' or "
        - "regional_bucket_location == 'us-west-1' or "
        - "regional_bucket_location == 'westus'"
      - select: { metadata: [objects_per_stream] }
        condition: objects_per_stream == '10000'
    type: visualization.LineChart
    options:
      hAxis: {format: short, maxValue: 256000000, title: object size}
      height: 600
      interpolateNulls: true
      legend: {position: inside}
      title: p50 upload latency vs object size
      vAxis: {maxValue: 8000, title: latency (ms)}
      width: 800
```
